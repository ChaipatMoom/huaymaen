<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LottoGenius AI ‚Äî Lucky Aura Edition</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Firebase + Chart.js -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #0f0e17;
      --card: rgba(255,255,255,0.08);
      --accent1: #a855f7;
      --accent2: #7c3aed;
      --gold: #facc15;
      --text: #f1f1f1;
      --muted: #b5b5b5;
      --glow: rgba(168,85,247,0.55);
    }

    body {
      font-family: 'Prompt', sans-serif;
      background: radial-gradient(circle at top, #1d1836 0%, #0f0e17 70%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      backdrop-filter: blur(8px);
      padding: 16px;
      box-shadow: 0 0 30px rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.06);
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: white;
      padding: 9px 16px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 0 14px var(--glow);
      transition: 0.15s;
    }
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 22px var(--glow);
    }

    .badge-sm {
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 600;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(4px);
    }

    .icon-box {
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
      box-shadow: inset 0 -5px 12px rgba(0,0,0,0.3);
    }

    select, input {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--text);
    }

    .muted { color: var(--muted); font-size: 13px; }
  </style>
</head>
<body>

<!-- HEADER -->
<header class="sticky top-0 z-50 backdrop-blur-md bg-black/40 border-b border-white/10">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <div class="icon-box" style="background:linear-gradient(135deg,var(--accent1),var(--accent2)); box-shadow:0 0 20px var(--glow);">
        <svg width="22" height="22" fill="white" viewBox="0 0 24 24">
          <path d="M12 2l2.6 5.8L21 9l-4.5 3.3L17.2 20 12 16.9 6.8 20l.7-7.7L3 9l6.4-1.2L12 2z"/>
        </svg>
      </div>
      <div>
        <div class="text-xl font-extrabold" style="color:var(--gold)">LottoGenius AI</div>
        <div class="muted text-xs">Lucky Aura ¬∑ Ensemble Model</div>
      </div>
    </div>

    <button class="btn-primary flex items-center gap-2" onclick="openModal()">
      <svg width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M12 5v14m7-7H5" stroke="white" stroke-width="2"/></svg>
      ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏´‡∏ß‡∏¢
    </button>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-7xl mx-auto px-4 py-6">

  <!-- TOP CARDS -->
  <section class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-8">

    <!-- Frequent 2 Digit -->
    <div class="card">
      <h3 class="text-lg font-semibold mb-2">üî• ‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢‡∏™‡∏∏‡∏î</h3>
      <div id="freq2" class="flex flex-wrap gap-2 mt-2"></div>
    </div>

    <!-- PIE -->
    <div class="card">
      <h3 class="text-lg font-semibold mb-2">‚öñÔ∏è ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô ‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô vs ‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏á</h3>
      <canvas id="pieChart" height="150"></canvas>
    </div>

    <!-- AI -->
    <div class="card" style="background:linear-gradient(135deg,#4c1d95,#7c3aed); box-shadow:0 0 22px rgba(124,58,237,0.6);">
      <h3 class="text-lg font-semibold text-white">üîÆ ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á AI (Lucky Aura)</h3>

      <div class="mt-3 space-y-2 text-white text-sm">
        <div>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1: <span id="aiFull6" class="text-xl font-extrabold"></span></div>
        <div>3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô: <span id="aiTop3"></span></div>
        <div>3 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á: <span id="aiLower3"></span></div>
        <div>2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á: <span id="aiBottom2"></span></div>
      </div>

      <div class="mt-2 text-xs text-white/70">Frequency + Delta + Recency Boost</div>
    </div>
  </section>

  <!-- RESULT LIST -->
  <section class="card mb-6">
    <div class="flex justify-between mb-4">
      <div>
        <h2 class="text-xl font-bold text-white">‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h2>
        <div class="muted text-xs">‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 12 ‡∏á‡∏ß‡∏î</div>
      </div>
      <select id="filterType" onchange="renderResults()" class="p-2 rounded">
        <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <option value="TH">‡πÑ‡∏ó‡∏¢</option>
        <option value="LAO">‡∏•‡∏≤‡∏ß</option>
        <option value="HANOI">‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢</option>
      </select>
    </div>

    <div id="results" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
  </section>

  <!-- SIMULATOR -->
  <section class="card p-4">
    <h3 class="font-semibold mb-3">üß™ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà (Simulator)</h3>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-7 gap-3">
      <select id="simType" class="p-2 rounded">
        <option value="TH">‡πÑ‡∏ó‡∏¢</option>
        <option value="LAO">‡∏•‡∏≤‡∏ß</option>
        <option value="HANOI">‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢</option>
      </select>

      <input type="date" id="simDate" class="p-2 rounded"/>

      <input type="text" id="simFull6" maxlength="6" placeholder="‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1" class="p-2 rounded text-center"/>

      <input type="text" id="simLower3a" maxlength="3" placeholder="3 ‡∏•‡πà‡∏≤‡∏á 1" class="p-2 rounded text-center"/>
      <input type="text" id="simLower3b" maxlength="3" placeholder="3 ‡∏•‡πà‡∏≤‡∏á 2" class="p-2 rounded text-center"/>

      <input type="text" id="simBottom" maxlength="2" placeholder="2 ‡∏•‡πà‡∏≤‡∏á" class="p-2 rounded text-center"/>

      <button onclick="saveSimulator()" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </section>

</main>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 hidden bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
  <div class="card max-w-lg w-full relative">

    <button onclick="closeModal()" class="absolute top-3 right-4 text-2xl text-white/70">√ó</button>

    <h3 class="text-xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏´‡∏ß‡∏¢‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>

    <form id="form" class="space-y-3">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <input type="date" id="date" required class="p-2 rounded"/>
        <select id="type" required class="p-2 rounded">
          <option value="TH">‡πÑ‡∏ó‡∏¢</option>
          <option value="LAO">‡∏•‡∏≤‡∏ß</option>
          <option value="HANOI">‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢</option>
        </select>
      </div>

      <input id="full6" maxlength="6" placeholder="‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1 (6 ‡∏´‡∏•‡∏±‡∏Å)" class="p-2 rounded w-full text-center" required />

      <input id="lower3a" maxlength="3" placeholder="3 ‡∏•‡πà‡∏≤‡∏á (1)" class="p-2 rounded w-full text-center" />
      <input id="lower3b" maxlength="3" placeholder="3 ‡∏•‡πà‡∏≤‡∏á (2)" class="p-2 rounded w-full text-center" />

      <input id="bottom" maxlength="2" placeholder="2 ‡∏•‡πà‡∏≤‡∏á" class="p-2 rounded w-full text-center" required />

      <button class="btn-primary w-full">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </form>

  </div>
</div>

<!-- SCRIPT -->
<script>

// ===== Firebase Config =====
const firebaseConfig = {
  apiKey:"AIzaSyCkS6eu3SuB5McIkS_7J8srMIhXQ7osc-E",
  authDomain:"huaymaen-lottoai.firebaseapp.com",
  databaseURL:"https://huaymaen-lottoai-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"huaymaen-lottoai",
  storageBucket:"huaymaen-lottoai.firebasestorage.app",
  messagingSenderId:"326340239586",
  appId:"1:326340239586:web:563d03ca906ca4ba327ebb",
  measurementId:"G-MF97ZM968E"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref('lottery');

let data = [];
let pieChart = null;

const pad = (s, n=2) => String(s||'').padStart(n,'0');

function formatDate(s){
  if(!s) return '-';
  return `${s.slice(6)}/${s.slice(4,6)}/${s.slice(0,4)}`;
}

/* ==========================
   FETCH + RENDER RESULTS
   ========================== */

function renderResults(){
  const container = document.getElementById('results');
  const filter = document.getElementById('filterType').value;
  let arr = data.slice();

  if(filter !== "all"){
    arr = arr.filter(x => x.type === filter);
  }

  arr = arr.slice(0,12);

  if(arr.length === 0){
    container.innerHTML = "<div class='p-4 muted text-center col-span-full'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>";
    return;
  }

  container.innerHTML = arr.map(x=>{
    const top3 = x.full6 ? x.full6.slice(-3) : "-";
    const lower = [x.lower3a, x.lower3b].filter(Boolean).join(", ");

    return `
      <div class="card p-3">
        <div class="flex justify-between mb-2">
          <div class="muted text-xs">${x.type}</div>
          <div class="text-xs text-yellow-300">${formatDate(x.date)}</div>
        </div>

        <div class="text-2xl font-extrabold mb-2">${x.full6}</div>

        <div class="grid grid-cols-3 gap-1 text-sm">
          <div>3 ‡∏ö‡∏ô<br><span class="text-green-300 font-bold">${top3}</span></div>
          <div>3 ‡∏•‡πà‡∏≤‡∏á<br><span class="text-green-300 font-bold">${lower||"-"}</span></div>
          <div>2 ‡∏•‡πà‡∏≤‡∏á<br><span class="text-pink-300 font-bold">${x.bottom||"-"}</span></div>
        </div>
      </div>`;
  }).join('');
}

/* ==========================
   CHART + STATS
   ========================== */

function updateStats(){
  if(pieChart) pieChart.destroy();

  let top=0, bottom=0;
  data.forEach(x=>{
    if(!x.full6) return;
    const first3 = Number(x.full6.slice(0,3));
    const last3  = Number(x.full6.slice(3));
    if(first3 > last3) top++; else bottom++;
  });

  const ctx = document.getElementById("pieChart").getContext("2d");
  pieChart = new Chart(ctx,{
    type:"doughnut",
    data:{
      labels:["‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô","‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏á"],
      datasets:[{
        data:[top,bottom],
        backgroundColor:["#c084fc","#4f46e5"]
      }]
    },
    options:{
      plugins:{ legend:{ labels:{ color:"white" }, position:"bottom" } }
    }
  });

  // freq 2-digit
  const freq = {};
  data.forEach(x=>{
    if(!x.bottom) return;
    const num = pad(x.bottom,2);
    freq[num] = (freq[num]||0)+1;
  });

  const top5 = Object.entries(freq)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,5);

  const el = document.getElementById("freq2");
  el.innerHTML = top5.map(([n])=>`<div class="badge-sm">${n}</div>`).join("");

  runAI();
}

/* ==========================
      AI ENSEMBLE
   ========================== */

function runAI(){
  const fullArr = data.map(d => d.full6).filter(Boolean);
  const lowerArr = [];
  data.forEach(d=>{
    if(d.lower3a) lowerArr.push(d.lower3a);
    if(d.lower3b) lowerArr.push(d.lower3b);
  });
  const bottomArr = data.map(d=>d.bottom).filter(Boolean);

  const freq = arr => {
    const m={};
    arr.forEach((v,i)=>{
      m[v]=(m[v]||0)+Math.exp(-0.04*i);
    });
    return m;
  };

  const top5 = map=>{
    return Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,5).map(([v])=>v);
  };

  // generate 6-digit prediction
  const f3 = fullArr.map(x=>x.slice(0,3));
  const l3 = fullArr.map(x=>x.slice(3));

  const mapF = freq(f3);
  const mapL = freq(l3);

  const bestF = top5(mapF)[0] || "000";
  const bestL = top5(mapL)[0] || "000";
  const fullPredict = bestF + bestL;

  // bottom 2
  const bottomPredict = top5(freq(bottomArr));

  // lower 3
  const lowerPredict = top5(freq(lowerArr));

  // write DOM
  document.getElementById("aiFull6").textContent = fullPredict;
  document.getElementById("aiTop3").textContent  = fullPredict.slice(-3);
  document.getElementById("aiLower3").textContent = lowerPredict.join(", ");
  document.getElementById("aiBottom2").textContent = bottomPredict.join(", ");
}

/* ==========================
   SAVE
   ========================== */

function saveSimulator(){
  const simDate = document.getElementById("simDate").value;
  const simType = document.getElementById("simType").value;
  const simFull6 = pad(document.getElementById("simFull6").value,6);
  const simLower3a = document.getElementById("simLower3a").value || "---";
  const simLower3b = document.getElementById("simLower3b").value || "---";
  const simBottom  = pad(document.getElementById("simBottom").value,2);

  if(!simDate || !simFull6 || !simBottom){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  db.push({
    date:simDate.replace(/-/g,""),
    type:simType,
    full6:simFull6,
    lower3a:simLower3a,
    lower3b:simLower3b,
    bottom:simBottom
  });
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
}

function openModal(){ document.getElementById("modal").classList.remove("hidden"); }
function closeModal(){ document.getElementById("modal").classList.add("hidden"); }

/* FORM SUBMIT */
document.getElementById("form").addEventListener("submit",e=>{
  e.preventDefault();

  const d = document.getElementById("date").value;
  const t = document.getElementById("type").value;
  const f = pad(document.getElementById("full6").value,6);
  const l1 = document.getElementById("lower3a").value || "---";
  const l2 = document.getElementById("lower3b").value || "---";
  const b = pad(document.getElementById("bottom").value,2);

  if(!d || !f || !b){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  db.push({
    date:d.replace(/-/g,""),
    type:t,
    full6:f,
    lower3a:l1,
    lower3b:l2,
    bottom:b
  });

  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  closeModal();
});

/* Firebase Listen */
db.on("value", snap=>{
  data = [];
  snap.forEach(c=>{
    data.push(c.val());
  });
  data.sort((a,b)=> (b.date||0)-(a.date||0));

  renderResults();
  updateStats();
});

</script>

</body>
</html>
